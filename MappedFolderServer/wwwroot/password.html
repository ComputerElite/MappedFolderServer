<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/style.css">
    <title>Password required</title>
</head>
<body>
    <h2>Password required for <span id="name"></span> </h2>
    <label for="password">Password</label><input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="error" class="error-box hidden">Incorrect password</p>
    <button onclick="adminLogin()">Login with Authentik</button>
    <script>
        const password = document.getElementById("password");
        const name = document.getElementById("name");
        const error = document.getElementById("error");
        const params = new URLSearchParams(window.location.search)
        const slug = params.get("slug");
        let redirect_after = params.get("redirect_after");
        const provided_password = params.get("password");
        
        if(provided_password) {
            password.value = provided_password;
            login()
        }
        if(!redirect_after) {
            redirect_after = `/${slug}`
        }
        
        name.innerText = slug;
        
        function login() {
            error.style.display = "none";
            
            fetch(`/api/v1/authorize/${slug}`, {method: "POST", headers: {
                    "content-type": "application/json"
                }, body: JSON.stringify({"Password": password.value})}).then(res => {
                if(res.ok) {
                    window.location.href = redirect_after;
                } else {
                    error.style.display = "block";
                }
            })
        }
        
        function adminLogin() {
            fetch(`/api/v1/authorize/`, {method: "POST", headers: {
                    "content-type": "application/json"
                }, body: JSON.stringify({"Password": "admin", "Username": "admin"})}).then(res => {
                if(res.ok) {
                    window.location.href = redirect_after;
                } else {
                    error.style.display = "block";
                }
            })
        }
    </script>
</body>
</html>