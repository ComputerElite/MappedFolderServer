<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MFS</title>
    <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
    <h1>Mapped Folder Server</h1>
    <a href="/password">Login</a>
    <a href="/slugs">Slugs</a>
    <br><br>
    <h1>Remote Open</h1>
    <p>Your code is <strong id="remoteId">Loading...</strong></p>
    <div id="qrcode" class="qrcode"></div>
    <br>
    <footer>
        <p>MappedFolderServer made by ComputerElite</p>
        <a href="https://github.com/ComputerElite/MappedFolderServer">GitHub</a>
    </footer>
    <script src="assets/qrcode.min.js"></script>
    <script>
        let remoteWs = new WebSocket("/api/v1/remotes/ws")
        const remoteId = document.getElementById('remoteId')
        
        function timeOut() {
            alert("The remote websocket timed out")
        }
        
        remoteWs.onopen = () => {
            console.log("Remote opened")
        }
        
        remoteWs.onmessage = (event) => {
            let data = JSON.parse(event.data);
            console.log(data)
            remoteId.innerText = data.id;
            new QRCode(document.getElementById("qrcode"), window.location.href.replace(window.location.pathname, "/") + "slugs?remoteId=" + data.id);
            if(data.secret) {
                location.href = `/api/v1/remotes/open/${data.id}?secret=${data.secret}`;
            }
        }
        
        remoteWs.onerror = (event) => {
            console.log("Remote error")
            timeOut()
        }
        
        remoteWs.onclose = (event) => {
            console.log("Remote closed")
            timeOut()
        }
    </script>
</body>
</html>